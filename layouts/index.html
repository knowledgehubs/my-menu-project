<!doctype html>
{{/* 1. تحديد السكين بناءً على ملف الإعدادات فقط */}}
{{ $skin := .Site.Params.active_skin | default "burger_joint" }}
{{ $data := index .Site.Data $skin }}

{{/* 2. التحقق من وجود البيانات لتجنب توقف البناء */}}
{{ if not $data }}
  <body>
    <div style="padding: 20px; font-family: sans-serif; text-align: center;">
      <h1 style="color: #dc2626;">Error: Skin '{{ $skin }}' not found.</h1>
      <p>Please check your <code>hugo.toml</code> and ensure the <code>active_skin</code> value matches a folder name in your <code>data/</code> directory.</p>
    </div>
  </body>
{{ else }}

<html lang="{{ $data.settings.language | default "en" }}" dir="{{ $data.settings.direction | default "ltr" }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>{{ $data.settings.title }}</title>
    
    {{/* 3. تحميل الستايل الأساسي ومعالجته */}}
    {{ $style := resources.Get "scss/main.scss" | toCSS | minify }}
    <link rel="stylesheet" href="{{ $style.Permalink }}">

    {{/* 4. حقن الألوان والخطوط ديناميكياً من البيانات */}}
    <style>
      :root {
        --primary: {{ $data.settings.primaryColor | default "#000" }};
        --accent: {{ $data.settings.accentColor | default "#333" }};
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      
      <header class="main-header">
        <div class="logo-area">
          {{/* استدعاء مكون الصورة المصغرة للوجو */}}
          {{ partial "thumbnail.html" (dict "image" $data.settings.logo "skin" $skin "w" 50 "h" 50 "alt" "Logo") }}
        </div>
        <div class="header-info">
          <h1>{{ $data.settings.title }}</h1>
        </div>
      </header>

      <nav class="sticky-nav">
        <div class="cat-list">
          <button class="cat-btn active" data-cat="all">All</button>
          {{ range $data.menu.categories }}
            <button class="cat-btn" data-cat="{{ .id }}">{{ .title }}</button>
          {{ end }}
        </div>
      </nav>

      <main id="menu-items">
        {{ range $data.menu.categories }}
          <section class="menu-section" data-category="{{ .id }}">
            <h2 class="section-title">{{ .title }}</h2>
            <div class="items-grid">
              {{ range .items }}
                {{/* استدعاء كارت الصنف وتمرير العملة */}}
                {{ partial "menu-item.html" (dict "item" . "skin" $skin "currency" $data.settings.currency) }}
              {{ end }}
            </div>
          </section>
        {{ end }}
      </main>

    </div>
    
    {{ $js := resources.Get "js/menu-filter.js" | minify }}
    <script src="{{ $js.RelPermalink }}"></script>
  </body>
</html>
{{ end }}
